version: '3.7'
services:
    postgresql:
        image: 'docker.io/bitnami/postgresql:11-debian-10'
        ports:
            - "127.0.0.1:5432:5432"
        volumes:
            - postgresql_data:/bitnami/postgresql
        environment:
            - 'ALLOW_EMPTY_PASSWORD=yes'

    jaeger:
        image: jaegertracing/all-in-one:latest
        ports:
            - "6831:6831/udp"
            - "16686:16686"
            - "14268:14268"
    eventstore:
        image: eventstore/eventstore:21.10.0-buster-slim
        environment:
          - EVENTSTORE_CLUSTER_SIZE=1
          - EVENTSTORE_RUN_PROJECTIONS=All
          - EVENTSTORE_START_STANDARD_PROJECTIONS=true
          - EVENTSTORE_EXT_TCP_PORT=1113
          - EVENTSTORE_HTTP_PORT=2113
          - EVENTSTORE_INSECURE=true
          - EVENTSTORE_ENABLE_EXTERNAL_TCP=true
          - EVENTSTORE_ENABLE_ATOM_PUB_OVER_HTTP=true
        ports:
          - "1113:1113"
          - "2113:2113"
        volumes:
          - type: volume
            source: eventstore-volume-data
            target: /var/lib/eventstore
          - type: volume
            source: eventstore-volume-logs
            target: /var/log/eventstore


volumes:
    eventstore-volume-data:
    eventstore-volume-logs:
    postgresql_data:
